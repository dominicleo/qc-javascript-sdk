!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).JSSDK={})}(this,function(e){"use strict";const t=100003,n="请确认 JSSDK 名称.",o=100004,s="JSSDK %s 响应超时",r=100005,c="JSBridge 不受支持.",i=100006,a="请确认 JSSDK 参数类型",d="undefined"!=typeof window;function l(e){return e instanceof Function}function u(e){if("object"!=typeof e||null===e)return!1;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}class w extends Error{constructor(e,t){super(e),this.code=null,this.name="SDKError",this.message=e,t&&(this.code=t)}}const f={debug:!1,timeout:1e4,timeoutExclude:["Moxiecert","watchShake","jump","faceplusplus","getAccessToken","registerCallback","resumeEvent","uploadImage","getWldData"],responseSuccessCode:0};function p(e){if(u(e))return e;try{return JSON.parse(e)}catch{return{}}}class S{constructor(e){this.id=1,this.options=f,this.options=Object.assign(this.options,S.defaults,e)}call(e,f){const{responseSuccessCode:m,timeout:g,timeoutExclude:h=[],transformRequest:b}=this.options,J=function(){if(!d)return!1;const e=!!(window&&window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.QCJSInterface&&window.webkit.messageHandlers.QCJSInterface.postMessage)&&window.webkit.messageHandlers.QCJSInterface.postMessage;if(l(e))return t=>{e(JSON.parse(JSON.stringify(t)))};const t=!!(window&&window.QCJSInterface&&window.QCJSInterface.callApp)&&window.QCJSInterface.callApp;return!!l(t)&&(e=>{t(JSON.stringify(e))})}();return e?f&&!u(f)?Promise.reject(new w(a,i)):l(J)?new Promise((t,n)=>{const r=this.callbackid(e),c={method:e,params:f,callback:r},{callback:i}=f||{};h.includes(e)||(S.timer[r]=setTimeout(()=>(l(S.cache[r])&&delete S.cache[r],n(new w(s.replace("%s",e),o))),g)),S.cache[r]=e=>{const o=p(e);return S.timer[r]&&clearTimeout(S.timer[r]),l(i)&&i(o),(o.code===m?t:n)(o)},l(b)&&(c.params=b(c.params,e)),J(c)}):Promise.reject(new w(c,r)):Promise.reject(new w(n,t))}track(e,t){return(new S).call(e,t)}callbackid(e){return["JSSDK",e,+new Date,++this.id].join("_")}logger(e){const t=(new Date).toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1");this.options.debug&&console.log(`JSSDK [${t}]`,e)}static appCallback(e){const t=p(e),{callbackid:n,data:o}=t,s=S.cache[n];l(s)&&s({...o})}}S.defaults=f,S.cache={},S.timer={},d&&(window.QCJSAPI||(window.QCJSAPI=S),window.QCJSSDK||(window.QCJSSDK=S)),e.SDKError=w,e.default=S,Object.defineProperty(e,"__esModule",{value:!0})});
