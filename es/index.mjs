var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};var t=function(){return(t=Object.assign||function(e){for(var t,n=1,r=arguments.length;r>n;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},n="undefined"!=typeof window;function r(e){return e instanceof Function}function o(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}var i=function(t){function n(e,n){var r=t.call(this,e)||this;return r.code=null,r.name="SDKError",r.message=e,n&&(r.code=n),r}return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}(n,t),n}(Error);function c(e){if(o(e))return e;try{return JSON.parse(e)}catch(e){return{}}}var a={debug:!1,timeout:1e4,timeoutExclude:["Moxiecert","watchShake","jump","faceplusplus","getAccessToken","registerCallback","resumeEvent","uploadImage","getWldData"],responseSuccessCode:0},s=function(){if(!n)return!1;var e=!!(window&&window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.QCJSInterface&&window.webkit.messageHandlers.QCJSInterface.postMessage)&&window.webkit.messageHandlers.QCJSInterface.postMessage;if(r(e))return function(t){e(JSON.parse(JSON.stringify(t)))};var t=!!(window&&window.QCJSInterface&&window.QCJSInterface.callApp)&&window.QCJSInterface.callApp;return!!r(t)&&function(e){t(JSON.stringify(e))}}(),u=function(){function e(e){this.id=1,this.options=Object.assign(a,e)}return e.prototype.callbackid=function(e){return["JSBridge",e,+new Date,++this.id].join("_")},e.prototype.call=function(t,n){var a=this,u=this.options,l=u.responseSuccessCode,f=u.timeout,p=u.timeoutExclude,d=void 0===p?[]:p,w=u.transformRequest;return t?n&&!o(n)?Promise.reject(new i("请确认 JSSDK 参数类型",100006)):r(s)?new Promise(function(o,u){var p=a.callbackid(t),S={method:t,params:n,callback:p},m=(n||{}).callback;d.includes(t)||(e.timer[p]=setTimeout(function(){return r(e.cache[p])&&delete e.cache[p],u(new i("JSSDK %s 响应超时".replace("%s",t),100004))},f)),e.cache[p]=function(t){var n=c(t);return e.timer[p]&&clearTimeout(e.timer[p]),r(m)&&m(n),(n.code===l?o:u)(n)},r(w)&&(S.params=w(S.params,t)),s(S)}):Promise.reject(new i("JSBridge 不受支持.",100005)):Promise.reject(new i("请确认 JSSDK 名称.",100003))},e.track=function(t,n){return new e({}).call(t,n)},e.prototype.logger=function(e){var t=(new Date).toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1");this.options.debug&&console.log("JSSDK ["+t+"]",e)},e.appCallback=function(n){var o=c(n),i=o.data,a=e.cache[o.callbackid];r(a)&&a(t({},i))},e.cache={},e.timer={},e}();n&&(window.QCJSAPI||(window.QCJSAPI=u),window.QCJSSDK||(window.QCJSSDK=u));export default u;export{i as SDKError};
